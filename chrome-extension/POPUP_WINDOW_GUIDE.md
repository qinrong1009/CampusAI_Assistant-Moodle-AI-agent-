# 🎉 獨立視窗版本使用指南

## ✅ 已完成的改變

### 1️⃣ **從 iframe 改為獨立視窗**
- ❌ 舊版：iframe 嵌入網頁，會被網頁操作重置
- ✅ 新版：獨立的 Chrome 視窗，完全獨立於網頁運行

### 2️⃣ **開啟方式**
1. **點擊 Extension 圖標** → 打開 AI 助手視窗
2. **快捷鍵 Cmd+Shift+A** (Mac) 或 Alt+A (Windows) → 打開 AI 助手視窗
3. 重複點擊會聚焦現有視窗，不會重複創建

### 3️⃣ **視窗特性**
- 寬度：500px
- 高度：700px
- 位置：螢幕右上角
- 類型：popup（無網址列、書籤列的精簡視窗）
- 可以自由移動和調整大小

### 4️⃣ **功能保留**
- ✅ 自動截圖當前網頁
- ✅ 聊天氣泡介面
- ✅ AI 分析回應
- ✅ 滾動不受影響（獨立視窗有自己的滾動）

---

## 🚀 測試步驟

### Step 1: 重新加載 Extension
```
1. 打開 chrome://extensions/
2. 找到 "校務系統AI助手"
3. 點擊 🔄 重新加載
```

### Step 2: 測試開啟視窗
```
方法 1: 點擊瀏覽器右上角的 Extension 圖標
方法 2: 按 Cmd+Shift+A (Mac) 或 Alt+A (Windows)
```

### Step 3: 測試功能
```
1. 在視窗中輸入問題：「這個網頁在講什麼？」
2. 點擊「發送」
3. 等待 AI 分析並回覆
```

### Step 4: 測試獨立性
```
1. 保持 AI 助手視窗開啟
2. 回到 Moodle 網頁進行操作（滾動、點擊）
3. AI 助手視窗應該 **不會被重置** ✅
```

---

## 🎯 優勢對比

| 特性 | iframe 版本 | 獨立視窗版本 ✅ |
|------|------------|----------------|
| 網頁操作影響 | ❌ 會被重置 | ✅ 完全獨立 |
| 滾動問題 | ❌ 可能阻擋網頁滾動 | ✅ 無影響 |
| 多標籤使用 | ❌ 每個標籤一個 | ✅ 全局共享 |
| 移動性 | ❌ 固定在頁面 | ✅ 可自由移動 |
| 關閉方式 | 快捷鍵切換 | 直接關閉視窗 |

---

## 📂 修改的檔案

1. **background.js**
   - 新增 `openChatWindow()` 函數
   - 使用 `chrome.windows.create()` 創建獨立視窗
   - 追蹤視窗 ID 避免重複創建

2. **sidebar.js**
   - 移除 `parent.postMessage()` 相關代碼
   - 改用 `chrome.runtime.sendMessage()` 直接與 background 通信
   - 截圖和 API 呼叫直接透過 background

3. **sidebar.html**
   - 更新標題為「校務系統 AI 助手」
   - 關閉按鈕改為 `window.close()`

4. **manifest.json**
   - 無需改動（已有所需權限）

---

## 🐛 可能的問題

### 問題 1: 視窗無法打開
**解決方案:**
```javascript
// 檢查 Console 錯誤
chrome://extensions/ → 背景頁 → Console
```

### 問題 2: 截圖失敗
**可能原因:**
- 沒有活躍的標籤頁
- 瀏覽器內建頁面（chrome://, edge://）無法截圖

**解決方案:**
```javascript
// 確保在普通網頁上測試（如 Moodle）
```

### 問題 3: API 連接失敗
**檢查清單:**
- [ ] Flask 後端是否運行在 http://localhost:5001
- [ ] Ollama 是否已啟動
- [ ] 模型是否已下載（qwen2.5vl:7b）

---

## 🎨 未來可改進的地方

1. **視窗大小記憶**
   - 使用 `chrome.storage` 記住上次的視窗大小和位置

2. **多視窗支援**
   - 允許同時開啟多個 AI 助手視窗

3. **聊天歷史**
   - 關閉視窗後保留聊天記錄

4. **主題切換**
   - 暗色模式/亮色模式

---

## ✅ 完成！

現在你的 AI 助手是一個完全獨立的視窗了！

**測試方式：**
1. 重新加載 Extension
2. 點擊圖標或按 Cmd+Shift+A
3. 在 Moodle 網頁上操作，AI 助手視窗不會受影響 ✨
