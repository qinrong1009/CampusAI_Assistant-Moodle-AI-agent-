# æ ¡å‹™ç³»çµ± AI åŠ©æ‰‹ - é–‹ç™¼æŒ‡å—

## ğŸ“š æ¶æ§‹æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Chrome Web Extension                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Popup      â”‚  â”‚  Content.js  â”‚  â”‚  Sidebar Panel   â”‚  â”‚
â”‚  â”‚   (UI)       â”‚  â”‚  (Injector)  â”‚  â”‚  (Input/Output)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    HTTP POST
                  /api/ask è«‹æ±‚
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Python Flask å¾Œç«¯ API                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  /api/ask (POST)                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ æ¥æ”¶: question, screenshot, model               â”‚   â”‚
â”‚  â”‚  â””â”€ è¿”å›: AI å›æ‡‰                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           AI Model Manager                          â”‚   â”‚
â”‚  â”‚  â”œâ”€ Qwen 2.5         (dashscope)                    â”‚   â”‚
â”‚  â”‚  â”œâ”€ GPT-4V           (openai)                       â”‚   â”‚
â”‚  â”‚  â””â”€ Claude 3 Vision  (anthropic)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    å¤–éƒ¨ API
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼
    Qwen API      OpenAI API      Claude API
```

## ğŸ—‚ï¸ æ–‡ä»¶çµæ§‹è©³è§£

### Chrome Extension (å‰ç«¯)

```
chrome-extension/
â”œâ”€â”€ manifest.json              # æ“´å±•é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ permissions: æ¬Šé™è²æ˜
â”‚   â”œâ”€â”€ host_permissions: ä¸»æ©Ÿæ¬Šé™
â”‚   â”œâ”€â”€ content_scripts: å…§å®¹è…³æœ¬é…ç½®
â”‚   â””â”€â”€ background: å¾Œå°æœå‹™å·¥ä½œè€…
â”‚
â”œâ”€â”€ src/html/
â”‚   â”œâ”€â”€ popup.html            # å½ˆçª—ç•Œé¢ï¼ˆé»æ“Šæ“´å±•åœ–æ¨™æ‰“é–‹ï¼‰
â”‚   â””â”€â”€ sidebar.html          # å´é‚Šæ¬„ç•Œé¢ï¼ˆåœ¨ç¶²é ä¸­æ³¨å…¥ï¼‰
â”‚
â”œâ”€â”€ src/css/
â”‚   â”œâ”€â”€ popup.css             # å½ˆçª—æ¨£å¼
â”‚   â””â”€â”€ sidebar.css           # å´é‚Šæ¬„æ¨£å¼
â”‚
â””â”€â”€ src/js/
    â”œâ”€â”€ popup.js              # å½ˆçª—é‚è¼¯
    â”‚   â”œâ”€â”€ è¨­å®šé¢æ¿ç®¡ç†
    â”‚   â”œâ”€â”€ API è¨­ç½®å­˜å„²
    â”‚   â””â”€â”€ å¿«æ·éµç›£è½
    â”‚
    â”œâ”€â”€ content.js            # å…§å®¹è…³æœ¬
    â”‚   â”œâ”€â”€ æ³¨å…¥å´é‚Šæ¬„ iframe
    â”‚   â”œâ”€â”€ ç›£è½ç”¨æˆ¶æ“ä½œ
    â”‚   â””â”€â”€ èˆ‡ background é€šä¿¡
    â”‚
    â”œâ”€â”€ sidebar.js            # å´é‚Šæ¬„æ‡‰ç”¨
    â”‚   â”œâ”€â”€ æˆªåœ–åŠŸèƒ½
    â”‚   â”œâ”€â”€ è¡¨å–®é©—è­‰
    â”‚   â”œâ”€â”€ API è«‹æ±‚
    â”‚   â””â”€â”€ çµæœå±•ç¤º
    â”‚
    â””â”€â”€ background.js         # å¾Œå°æœå‹™
        â”œâ”€â”€ æ¶ˆæ¯è·¯ç”±
        â””â”€â”€ å‘½ä»¤ç›£è½
```

### Python å¾Œç«¯

```
backend/
â”œâ”€â”€ app.py                    # Flask æ‡‰ç”¨å…¥å£
â”‚   â”œâ”€â”€ åˆå§‹åŒ– Flask æ‡‰ç”¨
â”‚   â”œâ”€â”€ é…ç½® CORS
â”‚   â”œâ”€â”€ éŒ¯èª¤è™•ç†
â”‚   â””â”€â”€ è·¯ç”±è¨»å†Š
â”‚
â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ DevelopmentConfig
â”‚   â”œâ”€â”€ ProductionConfig
â”‚   â””â”€â”€ TestingConfig
â”‚
â”œâ”€â”€ requirements.txt          # Python ä¾è³´
â”‚   â”œâ”€â”€ flask 3.0.0
â”‚   â”œâ”€â”€ flask-cors
â”‚   â”œâ”€â”€ dashscope (Qwen)
â”‚   â”œâ”€â”€ openai (GPT)
â”‚   â””â”€â”€ anthropic (Claude)
â”‚
â”œâ”€â”€ .env.example              # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”‚   â”œâ”€â”€ QWEN_API_KEY
â”‚   â”œâ”€â”€ OPENAI_API_KEY
â”‚   â””â”€â”€ CLAUDE_API_KEY
â”‚
â””â”€â”€ app/
    â”œâ”€â”€ __init__.py          # åŒ…åˆå§‹åŒ–
    â”‚
    â”œâ”€â”€ models/              # æ•¸æ“šå’Œ AI æ¨¡å‹
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ data_models.py   # è«‹æ±‚/å›æ‡‰æ•¸æ“šé¡
    â”‚   â”‚   â”œâ”€â”€ QueryRequest
    â”‚   â”‚   â”œâ”€â”€ QueryResponse
    â”‚   â”‚   â””â”€â”€ ModelInfo
    â”‚   â”‚
    â”‚   â””â”€â”€ ai_model.py      # AI é›†æˆ
    â”‚       â”œâ”€â”€ AIModel é¡
    â”‚       â”œâ”€â”€ _query_qwen()
    â”‚       â”œâ”€â”€ _query_gpt()
    â”‚       â”œâ”€â”€ _query_claude()
    â”‚       â””â”€â”€ process_query()
    â”‚
    â””â”€â”€ routes/              # API è·¯ç”±
        â”œâ”€â”€ __init__.py
        â””â”€â”€ api_routes.py    # API ç«¯é»å®šç¾©
            â”œâ”€â”€ POST /api/ask
            â”œâ”€â”€ GET /api/models
            â””â”€â”€ GET /api/test
```

## ğŸ”„ å·¥ä½œæµç¨‹

### ç”¨æˆ¶äº¤äº’æµç¨‹

```
ç”¨æˆ¶é»æ“Šæ“´å±•åœ–æ¨™
        â†“
å½ˆçª—æ‰“é–‹ (popup.html)
        â†“
é»æ“Š"å•Ÿå‹•åŠ©æ‰‹" æˆ– æŒ‰ Alt+A
        â†“
background.js ç™¼é€æ¶ˆæ¯åˆ° content.js
        â†“
content.js æ³¨å…¥å´é‚Šæ¬„ iframe (sidebar.html)
        â†“
å´é‚Šæ¬„åŠ è¼‰ (sidebar.js)
        â†“
ç”¨æˆ¶é»æ“Š"ğŸ“¸ æˆªåœ–"
        â†“
sidebar.js ä½¿ç”¨ html2canvas æˆªåœ–
        â†“
æˆªåœ–é¡¯ç¤ºåœ¨å´é‚Šæ¬„
        â†“
ç”¨æˆ¶è¼¸å…¥å•é¡Œ
        â†“
ç”¨æˆ¶é»æ“Š"ç™¼é€"
        â†“
sidebar.js å°‡æ•¸æ“š POST åˆ°å¾Œç«¯
        â†“
å¾Œç«¯ API æ¥æ”¶è«‹æ±‚ (/api/ask)
        â†“
AIModel é¡èª¿ç”¨ç›¸æ‡‰çš„ AI æ¨¡å‹
        â†“
AI æ¨¡å‹è¿”å›å›æ‡‰
        â†“
å¾Œç«¯è¿”å› JSON éŸ¿æ‡‰
        â†“
sidebar.js é¡¯ç¤ºå›æ‡‰
        â†“
ç”¨æˆ¶çœ‹åˆ° AI ç­”æ¡ˆ
```

## ğŸ› ï¸ é–‹ç™¼æŒ‡å—

### æ·»åŠ æ–°çš„ AI æ¨¡å‹

1. **åœ¨ `backend/app/models/ai_model.py` ä¸­æ·»åŠ æ–°æ–¹æ³•ï¼š**

```python
def _query_newmodel(self, question: str, image_data: bytes) -> str:
    """ä½¿ç”¨æ–°æ¨¡å‹å›æ‡‰"""
    try:
        # å¯¦ç¾é‚è¼¯
        return response_text
    except Exception as e:
        logger.error(f'æ–°æ¨¡å‹æŸ¥è©¢å¤±æ•—: {str(e)}')
        return f"éŒ¯èª¤: {str(e)}"
```

2. **åœ¨ `process_query()` æ–¹æ³•ä¸­æ·»åŠ æ¢ä»¶ï¼š**

```python
def process_query(self, question: str, screenshot: str, model_type: str = 'qwen') -> str:
    # ...
    if model_type == 'newmodel':
        return self._query_newmodel(question, image_data)
    # ...
```

3. **åœ¨ `get_available_models()` ä¸­åˆ—å‡ºæ–°æ¨¡å‹ï¼š**

```python
def get_available_models(self) -> dict:
    models = {
        # ...
        'newmodel': {
            'name': 'æ–°æ¨¡å‹åç¨±',
            'status': 'available' if self.newmodel_api_key else 'unconfigured'
        }
    }
    return models
```

### ä¿®æ”¹å‰ç«¯ UI

1. **ç·¨è¼¯ `chrome-extension/src/html/sidebar.html`** - ä¿®æ”¹ HTML çµæ§‹
2. **ç·¨è¼¯ `chrome-extension/src/css/sidebar.css`** - ä¿®æ”¹æ¨£å¼
3. **ç·¨è¼¯ `chrome-extension/src/js/sidebar.js`** - ä¿®æ”¹é‚è¼¯

### æ·»åŠ æ–°çš„ API ç«¯é»

åœ¨ `backend/app/routes/api_routes.py` ä¸­æ·»åŠ ï¼š

```python
@bp.route('/new-endpoint', methods=['POST'])
def new_endpoint():
    """æ–°çš„ API ç«¯é»"""
    try:
        data = request.get_json()
        # è™•ç†é‚è¼¯
        return jsonify({'status': 'success', 'data': result}), 200
    except Exception as e:
        logger.error(f'éŒ¯èª¤: {str(e)}')
        return jsonify({'error': str(e)}), 500
```

## ğŸ§ª æ¸¬è©¦

### å¾Œç«¯å–®å…ƒæ¸¬è©¦

```bash
cd backend
python -m pytest tests/ -v
```

### æ‰‹å‹• API æ¸¬è©¦

```bash
# ä½¿ç”¨ curl
curl -X POST http://localhost:5000/api/ask \
  -H "Content-Type: application/json" \
  -d '{
    "question": "é€™æ˜¯ä»€éº¼ï¼Ÿ",
    "screenshot": "data:image/jpeg;base64,...",
    "model": "qwen"
  }'
```

### å‰ç«¯æ¸¬è©¦

1. æ‰“é–‹ Chrome DevTools (F12)
2. åœ¨ Console æ¨™ç±¤ä¸­åŸ·è¡Œæ¸¬è©¦ä»£ç¢¼
3. æª¢æŸ¥ Network æ¨™ç±¤ä¸­çš„ API èª¿ç”¨

## ğŸ“Š æ€§èƒ½å„ªåŒ–å»ºè­°

### å‰ç«¯å„ªåŒ–
- ä½¿ç”¨ Web Workers è™•ç†æˆªåœ–
- å¯¦ç¾è«‹æ±‚ç·©å­˜
- å£“ç¸®æˆªåœ–å¤§å° (å·²åš 50% ç¸®æ”¾)
- å¯¦ç¾åŠ è¼‰ç‹€æ…‹æŒ‡ç¤º

### å¾Œç«¯å„ªåŒ–
- æ·»åŠ çµæœç·©å­˜ (Redis)
- å¯¦ç¾ç•°æ­¥ä»»å‹™éšŠåˆ— (Celery)
- å„ªåŒ–åœ–ç‰‡è™•ç†
- æ·»åŠ  API é€Ÿç‡é™åˆ¶

### æ•¸æ“šåº«å„ªåŒ– (æœªä¾†)
- è¨˜éŒ„ç”¨æˆ¶æŸ¥è©¢æ­·å²
- åˆ†æå¸¸è¦‹å•é¡Œ
- æ§‹å»ºçŸ¥è­˜åº«

## ğŸ”’ å®‰å…¨å»ºè­°

1. **ä¸è¦åœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼ API å¯†é‘°**
   - ä½¿ç”¨ `.env` æ–‡ä»¶
   - ä½¿ç”¨ç’°å¢ƒè®Šæ•¸

2. **é©—è­‰æ‰€æœ‰ç”¨æˆ¶è¼¸å…¥**
   - é™åˆ¶å•é¡Œé•·åº¦
   - é©—è­‰æˆªåœ–æ ¼å¼

3. **å¯¦ç¾ API é€Ÿç‡é™åˆ¶**
   - é˜²æ­¢æ¿«ç”¨
   - ä¿è­·å¾Œç«¯æœå‹™

4. **ä½¿ç”¨ HTTPS**
   - ç”Ÿç”¢ç’°å¢ƒå¿…é ˆä½¿ç”¨
   - é…ç½® SSL è­‰æ›¸

5. **è¨˜éŒ„å¯©è¨ˆæ—¥èªŒ**
   - è¨˜éŒ„æ‰€æœ‰ API è«‹æ±‚
   - ç›£æ§ç•°å¸¸æ´»å‹•

## ğŸ“± ç€è¦½å™¨å…¼å®¹æ€§

| åŠŸèƒ½ | Chrome | Edge | Chromium |
|------|--------|------|----------|
| åŸºæœ¬åŠŸèƒ½ | âœ… 88+ | âœ… 88+ | âœ… |
| MV3 | âœ… | âœ… | âœ… |
| Storage API | âœ… | âœ… | âœ… |
| Fetch API | âœ… | âœ… | âœ… |

## ğŸ› å¸¸è¦‹é–‹ç™¼å•é¡Œ

### å´é‚Šæ¬„ä¸é¡¯ç¤º

**æª¢æŸ¥æ¸…å–®:**
- [ ] manifest.json ä¸­ web_accessible_resources é…ç½®æ­£ç¢º
- [ ] sidebar.html è·¯å¾‘æ­£ç¢º
- [ ] content.js æ­£ç¢ºæ³¨å…¥ iframe
- [ ] ç€è¦½å™¨æ§åˆ¶å°æœ‰ç„¡ç´…è‰²éŒ¯èª¤

### API è«‹æ±‚å¤±æ•—

**æª¢æŸ¥æ¸…å–®:**
- [ ] å¾Œç«¯æœå‹™é‹è¡Œä¸­
- [ ] API åœ°å€æ­£ç¢º
- [ ] CORS é…ç½®æ­£ç¢º
- [ ] è«‹æ±‚æ•¸æ“šæ ¼å¼æ­£ç¢º

### æˆªåœ–ç‚ºç©º

**æª¢æŸ¥æ¸…å–®:**
- [ ] html2canvas åº«åŠ è¼‰æˆåŠŸ
- [ ] é é¢å…§å®¹å¯è¦‹
- [ ] æ²’æœ‰è·¨åŸŸé™åˆ¶

## ğŸ“ æäº¤ä»£ç¢¼å‰çš„æª¢æŸ¥æ¸…å–®

- [ ] ä»£ç¢¼å·²æ¸¬è©¦
- [ ] ç„¡æ§åˆ¶å°éŒ¯èª¤
- [ ] å·²æŒ‰ç…§ä»£ç¢¼é¢¨æ ¼è¦ç¯„
- [ ] å·²æ·»åŠ å¿…è¦çš„è¨»é‡‹
- [ ] API å¯†é‘°æœªæäº¤
- [ ] è™›æ“¬ç’°å¢ƒä¾è³´å·²æ›´æ–°

---

**ç‰ˆæœ¬**: 1.0.0  
**æœ€å¾Œæ›´æ–°**: 2024 å¹´ 10 æœˆ 31 æ—¥
